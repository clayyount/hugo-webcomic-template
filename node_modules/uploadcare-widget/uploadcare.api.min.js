/*
 * Uploadcare (3.7.7)
 * Date: 2019-07-31 14:45:42 +0300
 * Rev: 3eaac1473a
 */
!function(e,t){e.document&&("object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.uploadcare=t(e))}("undefined"!=typeof window?window:this,function(k,n){var A,U=k.document;return function(){A={__exports:{},namespace:function(e,t){var n,i,r,o,s;if(i=A,e)for(r=0,o=(s=e.split(".")).length;r<o;r++)i[n=s[r]]||(i[n]={}),i=i[n];return t(i)},expose:function(e,t){var n,i,r,o,s,a,u;for(n=(r=e.split(".")).pop(),s=A.__exports,o=A,a=0,u=r.length;a<u;a++)s[i=r[a]]||(s[i]={}),s=s[i],o=null!=o?o[i]:void 0;return s[n]=t||o[n]}}}.call(this),function(){var e,t;if((t=A).version="3.7.7",t.jQuery=n||k.jQuery,"undefined"==typeof t.jQuery)throw new ReferenceError("jQuery is not defined");(e=t.expose)("version"),e("jQuery"),e("plugin",function(e){return e(t)})}.call(this),k.XDomainRequest&&A.jQuery.ajaxTransport(function(n){var o;if(n.crossDomain&&n.async)return n.timeout&&(n.xdrTimeout=n.timeout,delete n.timeout),{send:function(e,r){function t(e,t,n,i){o.onload=o.onerror=o.ontimeout=function(){},o=undefined,r(e,t,n,i)}(o=new XDomainRequest).onload=function(){t(200,"OK",{text:o.responseText},"Content-Type: "+o.contentType)},o.onerror=function(){t(404,"Not Found")},o.onprogress=function(){},o.ontimeout=function(){t(0,"timeout")},o.timeout=n.xdrTimeout||Number.MAX_VALUE,o.open(n.type,n.url.replace(/^https?:/,"")),o.send(n.hasContent&&n.data||null)},abort:function(){o&&(o.onerror=function(){},o.abort())}}}),function(){A.namespace("utils.abilities",function(e){var t,n,i,r,o,s;e.fileAPI=!!(k.File&&k.FileList&&k.FileReader),e.sendFileAPI=!(!k.FormData||!e.fileAPI),e.dragAndDrop="draggable"in(o=U.createElement("div"))||"ondragstart"in o&&"ondrop"in o,e.canvas=!(!(s=U.createElement("canvas")).getContext||!s.getContext("2d")),e.fileDragAndDrop=e.fileAPI&&e.dragAndDrop,e.iOSVersion=null,(t=/^[^(]+\(iP(?:hone|od|ad);\s*(.+?)\)/.exec(navigator.userAgent))&&(i=/OS (\d)_(\d)/.exec(t[1]))&&(e.iOSVersion=+i[1]+i[2]/10),e.Blob=!1;try{new k.Blob&&(e.Blob=k.Blob)}catch(a){}return n=k.URL||k.webkitURL||!1,e.URL=n&&n.createObjectURL&&n,e.FileReader=(null!=(r=k.FileReader)?r.prototype.readAsArrayBuffer:void 0)&&k.FileReader})}.call(this),function(){var s,r={}.hasOwnProperty,n=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){return function(){return e.apply(t,arguments)}},u=[].slice;s=A.jQuery,A.namespace("utils",function(e){var t;return e.Collection=function(){function e(e){var t,n,i;for(null==e&&(e=[]),this.onAdd=s.Callbacks(),this.onRemove=s.Callbacks(),this.onSort=s.Callbacks(),this.onReplace=s.Callbacks(),this.__items=[],n=0,i=e.length;n<i;n++)t=e[n],this.add(t)}return e.prototype.add=function(e){return this.__add(e,this.__items.length)},e.prototype.__add=function(e,t){return this.__items.splice(t,0,e),this.onAdd.fire(e,t)},e.prototype.remove=function(e){var t;if(-1!==(t=s.inArray(e,this.__items)))return this.__remove(e,t)},e.prototype.__remove=function(e,t){return this.__items.splice(t,1),this.onRemove.fire(e,t)},e.prototype.clear=function(){var e,t,n,i,r,o;for(n=this.get(),o=[],e=i=this.__items.length=0,r=n.length;i<r;e=++i)t=n[e],o.push(this.onRemove.fire(t,e));return o},e.prototype.replace=function(e,t){var n;if(e!==t&&-1!==(n=s.inArray(e,this.__items)))return this.__replace(e,t,n)},e.prototype.__replace=function(e,t,n){return this.__items[n]=t,this.onReplace.fire(e,t,n)},e.prototype.sort=function(e){return this.__items.sort(e),this.onSort.fire()},e.prototype.get=function(e){return null!=e?this.__items[e]:this.__items.slice(0)},e.prototype.length=function(){return this.__items.length},e}(),e.UniqCollection=function(e){function i(){return t=i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.add=function(e){if(!(0<=o.call(this.__items,e)))return i.__super__.add.apply(this,arguments)},i.prototype.__replace=function(e,t,n){return 0<=o.call(this.__items,t)?this.remove(e):i.__super__.__replace.apply(this,arguments)},i}(e.Collection),e.CollectionOfPromises=function(e){function i(){this.onAnyProgress=a(this.onAnyProgress,this),this.onAnyFail=a(this.onAnyFail,this),this.onAnyDone=a(this.onAnyDone,this),this.anyDoneList=s.Callbacks(),this.anyFailList=s.Callbacks(),this.anyProgressList=s.Callbacks(),this._thenArgs=null,this.anyProgressList.add(function(e,t){return s(e).data("lastProgress",t)}),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.onAnyDone=function(e){var t,n,i,r,o;for(this.anyDoneList.add(e),o=[],n=0,i=(r=this.__items).length;n<i;n++)"resolved"===(t=r[n]).state()?o.push(t.done(function(){return e.apply(null,[t].concat(u.call(arguments)))})):o.push(void 0);return o},i.prototype.onAnyFail=function(e){var t,n,i,r,o;for(this.anyFailList.add(e),o=[],n=0,i=(r=this.__items).length;n<i;n++)"rejected"===(t=r[n]).state()?o.push(t.fail(function(){return e.apply(null,[t].concat(u.call(arguments)))})):o.push(void 0);return o},i.prototype.onAnyProgress=function(e){var t,n,i,r,o;for(this.anyProgressList.add(e),o=[],n=0,i=(r=this.__items).length;n<i;n++)t=r[n],o.push(e(t,s(t).data("lastProgress")));return o},i.prototype.lastProgresses=function(){var e,t,n,i,r;for(r=[],t=0,n=(i=this.__items).length;t<n;t++)e=i[t],r.push(s(e).data("lastProgress"));return r},i.prototype.add=function(e){if(e&&e.then)return this._thenArgs&&(e=e.then.apply(e,this._thenArgs)),i.__super__.add.apply(this,arguments),this.__watchItem(e)},i.prototype.__replace=function(e,t,n){return t&&t.then?(i.__super__.__replace.apply(this,arguments),this.__watchItem(t)):this.remove(e)},i.prototype.__watchItem=function(t){var e,n=this;return e=function(e){return function(){if(0<=o.call(n.__items,t))return e.fire.apply(e,[t].concat(u.call(arguments)))}},t.then(e(this.anyDoneList),e(this.anyFailList),e(this.anyProgressList))},i.prototype.autoThen=function(){var e,t,n,i,r,o;if(this._thenArgs)throw new Error("CollectionOfPromises.then() could be used only once");for(this._thenArgs=arguments,o=[],e=n=0,i=(r=this.__items).length;n<i;e=++n)t=r[e],o.push(this.__replace(t,t.then.apply(t,this._thenArgs),e));return o},i}(e.UniqCollection)})}.call(this),function(){var r;r=A.jQuery,A.namespace("utils",function(t){var n;return n=function(e,t){var n,i=this;return n=r.Deferred(),t&&(e.src=t),e.complete?n.resolve(e):(r(e).one("load",function(){return n.resolve(e)}),r(e).one("error",function(){return n.reject(e)})),n.promise()},t.imageLoader=function(e){return r.isArray(e)?r.when.apply(null,r.map(e,t.imageLoader)):e.src?n(e):n(new Image,e)},t.videoLoader=function(e){var t;return t=r.Deferred(),r("<video/>").on("loadeddata",t.resolve).on("error",t.reject).attr("src",e).get(0).load(),t.promise()}})}.call(this),function(){var r=[].slice;A.namespace("utils",function(i){var t;return i.log=function(){var e;try{return null!=(e=k.console)&&"function"==typeof e.log?e.log.apply(e,arguments):void 0}catch(t){}},i.debug=function(){var e,t;if(null==(e=k.console)||!e.debug)return i.log.apply(i,["Debug:"].concat(r.call(arguments)));try{return(t=k.console).debug.apply(t,arguments)}catch(n){}},i.warn=function(){var e,t;if(null==(e=k.console)||!e.warn)return i.log.apply(i,["Warning:"].concat(r.call(arguments)));try{return(t=k.console).warn.apply(t,arguments)}catch(n){}},t={},i.warnOnce=function(e){if(null==t[e])return t[e]=!0,i.warn(e)}})}.call(this),function(){var n;n=A.jQuery,A.namespace("utils",function(e){var l,t=this;return l={},n(k).on("message",function(e){var t,n,i,r,o,s,a;t=e.originalEvent;try{i=JSON.parse(t.data)}catch(u){return}if((null!=i?i.type:void 0)&&i.type in l){for(a=[],r=0,o=(s=l[i.type]).length;r<o;r++)n=s[r],t.source===n[0]?a.push(n[1](i)):a.push(void 0);return a}}),e.registerMessage=function(e,t,n){return e in l||(l[e]=[]),l[e].push([t,n])},e.unregisterMessage=function(e,t){if(e in l)return l[e]=n.grep(l[e],function(e){return e[0]!==t})}})}.call(this),function(){var p,o=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},n=[].slice;p=A.jQuery,A.namespace("utils",function(u){var t
;return u.unique=function(e){var t,n,i,r;for(n=[],i=0,r=e.length;i<r;i++)t=e[i],o.call(n,t)<0&&n.push(t);return n},u.defer=function(e){return setTimeout(e,0)},u.gcd=function(e,t){var n;while(t)n=e%t,e=t,t=n;return e},u.once=function(e){var t,n;return t=!1,n=null,function(){return t||(n=e.apply(this,arguments),t=!0),n}},u.wrapToPromise=function(e){return p.Deferred().resolve(e).promise()},u.then=function(e,t,n,i){var r,o;return o=p.Deferred(),r=function(e,t){return e&&t?function(){return t.call(this,e.apply(this,arguments))}:e||t},e.then(r(t,o.resolve),r(n,o.reject),r(i,o.notify)),o.promise()},u.bindAll=function(i,e){var r;return r={},p.each(e,function(e,t){var n;return n=i[t],p.isFunction(n)?r[t]=function(){var e;return(e=n.apply(i,arguments))===i?r:e}:r[t]=n}),r},u.upperCase=function(e){return e.replace(/([A-Z])/g,"_$1").toUpperCase()},u.publicCallbacks=function(e){var t;return(t=e.add).add=e.add,t.remove=e.remove,t},u.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t,n;return t=16*Math.random()|0,(n="x"===e?t:3&t|8).toString(16)})},u.splitUrlRegex=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)\??([^\#]*)\#?(.*)$/,u.uuidRegex=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,u.groupIdRegex=new RegExp(u.uuidRegex.source+"~[0-9]+","i"),u.cdnUrlRegex=new RegExp("^/?("+u.uuidRegex.source+")(?:/(-/(?:[^/]+/)+)?([^/]*))?$","i"),u.splitCdnUrl=function(e){return u.cdnUrlRegex.exec(u.splitUrlRegex.exec(e)[3])},u.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},u.globRegexp=function(e,t){var n;return null==t&&(t="i"),n=p.map(e.split("*"),u.escapeRegExp),new RegExp("^"+n.join(".+")+"$",t)},u.normalizeUrl=function(e){var t;return"http:"!==(t=U.location.protocol)&&(t="https:"),e.replace(/^\/\//,t+"//").replace(/\/+$/,"")},u.fitText=function(e,t){var n,i;return e.length>t?(n=Math.ceil((t-3)/2),i=Math.floor((t-3)/2),e.slice(0,n)+"..."+e.slice(-i)):e},u.fitSizeInCdnLimit=function(e){return u.fitSize(e,[2048,2048])},u.fitSize=function(e,t,n){var i,r;return e[0]>t[0]||e[1]>t[1]||n?(r=t[0]/e[0],i=t[1]/e[1],!t[0]||t[1]&&i<r?[Math.round(i*e[0]),t[1]]:[t[0],Math.round(r*e[1])]):e.slice()},u.applyCropCoordsToInfo=function(e,t,n,i){var r,o,s,a,u,l,c;return l=i.width,o=i.height,a=t.preferedSize,s="",(c=l===n[0]&&o===n[1])||(s+="-/crop/"+l+"x"+o+"/"+i.left+","+i.top+"/"),r=t.downscale&&(l>a[0]||o>a[1]),u=t.upscale&&(l<a[0]||o<a[1]),r||u?(i.sw=a[0],i.sh=a[1],s+="-/resize/"+a.join("x")+"/"):c||(s+="-/preview/"),(e=p.extend({},e)).cdnUrlModifiers=s,e.cdnUrl=""+e.originalUrl+(s||""),e.crop=i,e},u.fileInput=function(e,t,n){var i,o,r;return o=null,""===(i=t.inputAcceptTypes)&&(i=t.imagesOnly?"image/*":null),(r=function(){return o=(t.multiple?p('<input type="file" multiple>'):p('<input type="file">')).attr("accept",i).css({position:"absolute",top:0,opacity:0,margin:0,padding:0,width:"auto",height:"auto",cursor:e.css("cursor")}).on("change",function(){return n(this),p(this).hide(),r()}),e.append(o)})(),e.css({position:"relative",overflow:"hidden"}).mousemove(function(e){var t,n,i,r;return t=(r=p(this).offset()).left,n=r.top,i=o.width(),o.css({left:e.pageX-t-i+10,top:e.pageY-n-10})})},u.fileSelectDialog=function(e,t,n,i){var r;return null==i&&(i={}),""===(r=t.inputAcceptTypes)&&(r=t.imagesOnly?"image/*":null),p(t.multiple?'<input type="file" multiple>':'<input type="file">').attr("accept",r).attr(i).css({position:"fixed",bottom:0,opacity:0}).on("change",function(){return n(this),p(this).remove()}).appendTo(e).focus().click().hide()},u.fileSizeLabels="B KB MB GB TB PB EB ZB YB".split(" "),u.readableFileSize=function(e,t,n,i){var r,o,s,a;if(null==t&&(t=""),null==n&&(n=""),null==i&&(i=""),e=parseInt(e,10),isNaN(e))return t;r=2,s=0,a=1e3-5*Math.pow(10,2-Math.max(r,3));while(a<e&&s<u.fileSizeLabels.length-1)s++,e/=1024;return e+=1e-15,o=Math.max(0,r-Math.floor(e).toFixed(0).length),""+n+(e=Number(e.toFixed(o)))+" "+u.fileSizeLabels[s]+i},u.ajaxDefaults={dataType:"json",crossDomain:!0,cache:!1},u.jsonp=function(r,e,t,n){return null==n&&(n={}),p.ajax(p.extend({url:r,type:e,data:t},n,u.ajaxDefaults)).then(function(e){var t;return e.error?(t=e.error.content||e.error,p.Deferred().reject(t)):e},function(e,t,n){var i;return i=t+" ("+n+")",u.warn("JSONP unexpected error: "+i+" while loading "+r),i})},u.canvasToBlob=function(e,t,n,i){var r,o,s,a,u,l;if(HTMLCanvasElement.prototype.toBlob)return e.toBlob(i,t,n);for(s=(s=e.toDataURL(t,n)).split(","),o=atob(s[1]),r=new Uint8Array(o.length),a=u=0,l=o.length;u<l;a=u+=1)r[a]=o.charCodeAt(a);return i(new Blob([r],{type:/:(.+\/.+);/.exec(s[0])[1]}))},u.taskRunner=function(t){var n,i,e,r;return r=0,n=[],i=function(){var e;return n.length?(e=n.shift(),u.defer(function(){return e(i)})):r-=1},function(e){return!t||r<t?(r+=1,u.defer(function(){return e(i)})):n.push(e)}},t=[["notify","progress",2],["resolve","done",0],["reject","fail",1]],u.fixedPipe=function(e){var r,o;return o=e,r=2<=arguments.length?n.call(arguments,1):[],p.Deferred(function(i){return p.each(t,function(e,t){var n;return n=p.isFunction(r[t[2]])&&r[t[2]],o[t[1]](function(){var e;return(e=n&&n.apply(this,arguments))&&p.isFunction(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[t[0]+"With"](this===o?i.promise():this,n?[e]:arguments)})})}).promise()}})}.call(this),function(){var b,w,x,S,C=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};w=A.expose,x=A.utils,b=A.jQuery,S=A.version,A.namespace("settings",function(i){var n,r,o,s,a,u,l,e,c,p,f,h,d,t,_,g,m,y,v;return a={live:!0,manualStart:!1,locale:null,localePluralize:null,localeTranslations:null,systemDialog:!1,crop:!1,previewStep:!1,imagesOnly:!1,clearable:!1,multiple:!1,multipleMax:1e3,multipleMin:1,multipleMaxStrict:!1,imageShrink:!1,pathValue:!0,tabs:"file camera url facebook gdrive gphotos dropbox instagram evernote flickr onedrive",preferredTypes:"",inputAcceptTypes:"",doNotStore:!1,publicKey:null,secureSignature:"",secureExpire:"",pusherKey:"79ae88bd931ea68464d9",cdnBase:"https://ucarecdn.com",urlBase:"https://upload.uploadcare.com",socialBase:"https://social.uploadcare.com",previewProxy:null,previewUrlCallback:null,imagePreviewMaxSize:26214400,multipartMinSize:10485760,multipartPartSize:5242880,multipartMinLastPartSize:1048576,multipartConcurrency:4,multipartMaxAttempts:3,parallelDirectUploads:10,passWindowOpen:!1,audioBitsPerSecond:null,videoBitsPerSecond:null,scriptBase:"//ucarecdn.com/widget/"+A.version+"/uploadcare/",debugUploads:!1,integration:""},m={multipleMax:{from:0,to:1e3}},o={multipleMax:{min:1,max:1e3}},d={tabs:{all:"file camera url facebook gdrive gphotos dropbox instagram evernote flickr onedrive box vk huddle","default":a.tabs}},t=U.currentScript||(v=U.getElementsByTagName("script"))[v.length-1],void 0!==(e=b(t).data("integration"))&&(a=b.extend(a,{integration:e})),_=function(e){return b.isArray(e)||(e=(e=b.trim(e))?e.split(" "):[]),e},n=function(e,t){var n,i,r,o,s,a,u,l;for(s=0,u=t.length;s<u;s++){if(i=t[s],o=r=_(e[i]),d.hasOwnProperty(i))for(o=[],a=0,l=r.length;a<l;a++)n=r[a],d[i].hasOwnProperty(n)?o=o.concat(_(d[i][n])):o.push(n);e[i]=x.unique(o)}return e},y=function(e,t){var n,i,r;for(i=0,r=t.length;i<r;i++)null!=e[n=t[i]]&&(e[n]=x.normalizeUrl(e[n]));return e},u=function(e,t){var n,i,r,o;for(r=0,o=t.length;r<o;r++)null!=e[n=t[r]]&&("string"==typeof(i=e[n])?(i=b.trim(i).toLowerCase(),e[n]=!("false"===i||"disabled"===i)):e[n]=!!i);return e},l=function(e,t){var n,i,r;for(i=0,r=t.length;i<r;i++)null!=e[n=t[i]]&&(e[n]=parseInt(e[n]));return e},c=function(e){return e._userAgent="UploadcareWidget/"+S+"/"+e.publicKey+" (JavaScript"+(e.integration?"; "+e.integration:"")+")",e},g=function(e,t){var n,i;for(n in t)i=t[n],null!=e[n]&&e[n]===i.from&&(e[n]=i.to);return e},r=function(e,t){var n,i,r,o;for(n in t)r=(o=t[n]).min,i=o.max,null!=e[n]&&(e[n]=Math.min(Math.max(e[n],r),i));return e},f=function(e){var t,n;return{downscale:"x"===(t=(n=/^([0-9]+)([x:])([0-9]+)\s*(|upscale|minimum)$/i).exec(b.trim(e.toLowerCase()))||[])[2],upscale:!!t[4],notLess:"minimum"===t[4],preferedSize:t.length?[+t[1],+t[3]]:void 0}},h=function(e){var t,n,i;return!!(
n=(t=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i).exec(b.trim(e.toLowerCase()))||[]).length&&(5e6<(i=n[1]*n[2])?(x.warnOnce("Shrinked size can not be larger than 5MP. You have set "+n[1]+"x"+n[2]+" ("+Math.ceil(i/1e3/100)/10+"MP)."),!1):{quality:n[3]?n[3]/100:void 0,size:i})},s=function(e,t){var n,i,r,o;return this.previewProxy?(i=(r=!/\?/.test(this.previewProxy))||!/\=$/.test(this.previewProxy),n=!r&&!/[\&\?\=]$/.test(this.previewProxy),o=encodeURIComponent(e),i&&(o="url="+o),n&&(o="&"+o),r&&(o="?"+o),this.previewProxy+o):e},p=function(e){var t;return n(e,["tabs","preferredTypes"]),y(e,["cdnBase","socialBase","urlBase","scriptBase"]),u(e,["doNotStore","imagesOnly","multiple","clearable","pathValue","previewStep","systemDialog","debugUploads","multipleMaxStrict"]),l(e,["multipleMax","multipleMin","multipartMinSize","multipartPartSize","multipartMinLastPartSize","multipartConcurrency","multipartMaxAttempts","parallelDirectUploads"]),g(e,m),r(e,o),c(e),!1===e.crop||b.isArray(e.crop)||(/^(disabled?|false|null)$/i.test(e.crop)?e.crop=!1:b.isPlainObject(e.crop)?e.crop=[e.crop]:e.crop=b.map((""+e.crop).split(","),f)),e.imageShrink&&!b.isPlainObject(e.imageShrink)&&(e.imageShrink=h(e.imageShrink)),(e.crop||e.multiple)&&(e.previewStep=!0),x.abilities.sendFileAPI||(e.systemDialog=!1),e.validators&&(e.validators=e.validators.slice()),e.previewProxy&&!e.previewUrlCallback&&(e.previewUrlCallback=s),-1!==(t=e.tabs.indexOf("skydrive"))&&(e.tabs[t]="onedrive"),e},w("defaults",b.extend({allTabs:d.tabs.all},a)),i.globals=function(){var e,t,n;for(e in t={},a)void 0!==(n=k["UPLOADCARE_"+x.upperCase(e)])&&(t[e]=n);return t},i.common=x.once(function(e,t){var n;return t||(a=b.extend(a,i.globals())),n=p(b.extend(a,e||{})),i.waitForSettings.fire(n),n}),i.build=function(e){var t;return t=b.extend({},i.common()),b.isEmptyObject(e)||(t=p(b.extend(t,e))),t},i.waitForSettings=b.Callbacks("once memory"),i.CssCollector=function(){function e(){this.urls=[],this.styles=[]}return e.prototype.addUrl=function(e){if(!/^https?:\/\//i.test(e))throw new Error("Embedded urls should be absolute. "+e);if(!(0<=C.call(this.urls,e)))return this.urls.push(e)},e.prototype.addStyle=function(e){return this.styles.push(e)},e}(),A.tabsCss=new i.CssCollector,a._emptyKeyText='<div class="uploadcare--tab__content">\n<div class="uploadcare--text uploadcare--text_size_large uploadcare--tab__title">Hello!</div>\n<div class="uploadcare--text">Your <a class="uploadcare--link" href="https://uploadcare.com/dashboard/">public key</a> is not set.</div>\n<div class="uploadcare--text">Add this to the &lt;head&gt; tag to start uploading files:</div>\n<div class="uploadcare--text uploadcare--text_pre">&lt;script&gt;\nUPLOADCARE_PUBLIC_KEY = \'your_public_key\';\n&lt;/script&gt;</div>\n</div>'})}.call(this),function(){A.namespace("locale.translations",function(e){return e.en={uploading:"Uploading... Please wait.",loadingInfo:"Loading info...",errors:{"default":"Error",baddata:"Incorrect value",size:"File too big",upload:"Can’t upload",user:"Upload canceled",info:"Can’t load info",image:"Only images allowed",createGroup:"Can’t create file group",deleted:"File was deleted"},draghere:"Drop a file here",file:{one:"%1 file",other:"%1 files"},buttons:{cancel:"Cancel",remove:"Remove",choose:{files:{one:"Choose a file",other:"Choose files"},images:{one:"Choose an image",other:"Choose images"}}},dialog:{close:"Close",openMenu:"Open menu",done:"Done",showFiles:"Show files",tabs:{names:{"empty-pubkey":"Welcome",preview:"Preview",file:"Local Files",url:"Direct Link",camera:"Camera",facebook:"Facebook",dropbox:"Dropbox",gdrive:"Google Drive",gphotos:"Google Photos",instagram:"Instagram",vk:"VK",evernote:"Evernote",box:"Box",onedrive:"OneDrive",flickr:"Flickr",huddle:"Huddle"},file:{drag:"drag & drop<br>any files",nodrop:"Upload files from your&nbsp;computer",cloudsTip:"Cloud storages<br>and social networks",or:"or",button:"Choose a local file",also:"or choose from"},url:{title:"Files from the Web",line1:"Grab any file off the web.",line2:"Just provide the link.",input:"Paste your link here...",button:"Upload"},camera:{title:"File from web camera",capture:"Take a photo",mirror:"Mirror",startRecord:"Record a video",stopRecord:"Stop",cancelRecord:"Cancel",retry:"Request permissions again",pleaseAllow:{title:"Please allow access to your camera",text:"You have been prompted to allow camera access from this site.<br>In order to take pictures with your camera you must approve this request."},notFound:{title:"No camera detected",text:"Looks like you have no camera connected to this device."}},preview:{unknownName:"unknown",change:"Cancel",back:"Back",done:"Add",unknown:{title:"Uploading... Please wait for a preview.",done:"Skip preview and accept"},regular:{title:"Add this file?",line1:"You are about to add the file above.",line2:"Please confirm."},image:{title:"Add this image?",change:"Cancel"},crop:{title:"Crop and add this image",done:"Done",free:"free"},video:{title:"Add this video?",change:"Cancel"},error:{"default":{title:"Oops!",text:"Something went wrong during the upload.",back:"Please try again"},image:{title:"Only image files are accepted.",text:"Please try again with another file.",back:"Choose image"},size:{title:"The file you selected exceeds the limit.",text:"Please try again with another file."},loadImage:{title:"Error",text:"Can’t load image"}},multiple:{title:"You’ve chosen %files%.",question:"Add %files%?",tooManyFiles:"You’ve chosen too many files. %max% is maximum.",tooFewFiles:"You’ve chosen %files%. At least %min% required.",clear:"Remove all",done:"Add",file:{preview:"Preview %file%",remove:"Remove %file%"}}}},footer:{text:"powered by",link:"uploadcare"}}}}),A.namespace("locale.pluralize",function(e){return e.en=function(e){return 1===e?"one":"other"}})}.call(this),function(){var u,i,t;t=A.utils,i=A.settings,u=A.jQuery,A.namespace("locale",function(r){var o,e,s,a,n;return s={lang:e="en",translations:r.translations[e],pluralize:r.pluralize[e]},n=function(e){var t,n,i;return{lang:t=e.locale||s.lang,translations:i=u.extend(!0,{},r.translations[t],e.localeTranslations),pluralize:n=u.isFunction(e.localePluralize)?e.localePluralize:r.pluralize[t]}},o=t.once(function(){return n(i.build())}),r.rebuild=function(e){var t;return t=n(i.build(e)),o=function(){return t}},a=function(e,t){var n,i,r,o;for(r=0,o=(n=e.split(".")).length;r<o;r++){if(i=n[r],null==t)return null;t=t[i]}return t},r.t=function(e,t){var n,i,r;return n=o(),null==(i=a(e,n.translations))&&n.lang!==s.lang&&(i=a(e,(n=s).translations)),null!=t&&(i=null!=n.pluralize?(null!=(r=i[n.pluralize(t)])?r.replace("%1",t):void 0)||t:""),i||""}})}.call(this),function(){var t,e,n,o,r=function(e,t){return function(){return e.apply(t,arguments)}},i=[].slice;e=A.namespace,n=A.settings,t=A.jQuery,o=A.utils,e("files",function(e){return e.BaseFile=function(){function e(e,t,n){var i;this.settings=t,this.sourceInfo=null!=n?n:{},this.__extendApi=r(this.__extendApi,this),this.__cancel=r(this.__cancel,this),this.__resolveApi=r(this.__resolveApi,this),this.__rejectApi=r(this.__rejectApi,this),this.__runValidators=r(this.__runValidators,this),this.__fileInfo=r(this.__fileInfo,this),this.__handleFileData=r(this.__handleFileData,this),this.__updateInfo=r(this.__updateInfo,this),this.__completeUpload=r(this.__completeUpload,this),this.fileId=null,this.fileName=null,this.sanitizedName=null,this.fileSize=null,this.isStored=null,this.cdnUrlModifiers=null,this.isImage=null,this.imageInfo=null,this.mimeType=null,this.s3Bucket=null,(i=this.sourceInfo).source||(i.source=this.sourceName),this.__setupValidation(),this.__initApi()}return e.prototype.__startUpload=function(){return t.Deferred().resolve()},e.prototype.__completeUpload=function(){var e,t,n,i,r=this;return n=0,this.settings.debugUploads&&(o.debug("Load file info.",this.fileId,this.settings.publicKey),t=setInterval(function(){return o.debug("Still waiting for file ready.",n,r.fileId,r.settings.publicKey)},5e3),this.apiDeferred.done(function(){return o.debug("File uploaded.",n,r.fileId,r.settings.publicKey)}).always(function(){return clearInterval(t)})),i=100,(e=function(){if("pending"===r.apiDeferred.state())return n+=1,
r.__updateInfo().done(function(){return setTimeout(e,i),i+=50})})()},e.prototype.__updateInfo=function(){var t=this;return o.jsonp(this.settings.urlBase+"/info/","GET",{jsonerrors:1,file_id:this.fileId,pub_key:this.settings.publicKey,wait_is_ready:+(null===this.isImage)},{headers:{"X-UC-User-Agent":this.settings._userAgent}}).fail(function(e){return t.settings.debugUploads&&o.log("Can't load file info. Probably removed.",t.fileId,t.settings.publicKey,e),t.__rejectApi("info")}).done(this.__handleFileData)},e.prototype.__handleFileData=function(e){if(this.fileName=e.original_filename,this.sanitizedName=e.filename,this.fileSize=e.size,this.isImage=e.is_image,this.imageInfo=e.image_info,this.mimeType=e.mime_type,this.isStored=e.is_stored,this.s3Bucket=e.s3_bucket,e.default_effects&&(this.cdnUrlModifiers="-/"+e.default_effects),this.s3Bucket&&this.cdnUrlModifiers&&this.__rejectApi("baddata"),this.__runValidators(),e.is_ready)return this.__resolveApi()},e.prototype.__progressInfo=function(){var e;return{state:this.__progressState,uploadProgress:this.__progress,progress:"ready"===(e=this.__progressState)||"error"===e?1:.9*this.__progress,incompleteFileInfo:this.__fileInfo()}},e.prototype.__fileInfo=function(){var e;return e=this.s3Bucket?"https://"+this.s3Bucket+".s3.amazonaws.com/"+this.fileId+"/"+this.sanitizedName:this.settings.cdnBase+"/"+this.fileId+"/",{uuid:this.fileId,name:this.fileName,size:this.fileSize,isStored:this.isStored,isImage:!this.s3Bucket&&this.isImage,originalImageInfo:this.imageInfo,mimeType:this.mimeType,originalUrl:this.fileId?e:null,cdnUrl:this.fileId?""+e+(this.cdnUrlModifiers||""):null,cdnUrlModifiers:this.cdnUrlModifiers,sourceInfo:this.sourceInfo}},e.prototype.__setupValidation=function(){if(this.validators=this.settings.validators||this.settings.__validators||[],this.settings.imagesOnly)return this.validators.push(function(e){if(!1===e.isImage)throw new Error("image")})},e.prototype.__runValidators=function(){var e,t,n,i,r,o,s;t=this.__fileInfo();try{for(o=this.validators,s=[],i=0,r=o.length;i<r;i++)n=o[i],s.push(n(t));return s}catch(a){return e=a,this.__rejectApi(e.message)}},e.prototype.__initApi=function(){return this.apiDeferred=t.Deferred(),this.__progressState="uploading",this.__progress=0,this.__notifyApi()},e.prototype.__notifyApi=function(){return this.apiDeferred.notify(this.__progressInfo())},e.prototype.__rejectApi=function(e){return this.__progressState="error",this.__notifyApi(),this.apiDeferred.reject(e,this.__fileInfo())},e.prototype.__resolveApi=function(){return this.__progressState="ready",this.__notifyApi(),this.apiDeferred.resolve(this.__fileInfo())},e.prototype.__cancel=function(){return this.__rejectApi("user")},e.prototype.__extendApi=function(e){var t=this;return e.cancel=this.__cancel,e.pipe=e.then=function(){return t.__extendApi(o.fixedPipe.apply(o,[e].concat(i.call(arguments))))},e},e.prototype.promise=function(){var e,t=this;return this.__apiPromise||(this.__apiPromise=this.__extendApi(this.apiDeferred.promise()),this.__runValidators(),"pending"===this.apiDeferred.state()&&((e=this.__startUpload()).done(function(){return t.__progressState="uploaded",t.__progress=1,t.__notifyApi(),t.__completeUpload()}),e.progress(function(e){if(e>t.__progress)return t.__progress=e,t.__notifyApi()}),e.fail(function(){return t.__rejectApi("upload")}),this.apiDeferred.always(e.reject))),this.__apiPromise},e}()}),e("utils",function(n){return n.isFile=function(e){return e&&e.done&&e.fail&&e.cancel},n.valueToFile=function(e,t){return e&&!n.isFile(e)&&(e=A.fileFrom("uploaded",e,t)),e||null}})}.call(this),function(){var m,y,i,r,v,e,t;m=A.jQuery,v=A.utils,t=(e=A.utils).abilities,y=t.Blob,i=t.FileReader,r=t.URL,A.namespace("utils.image",function(g){var _,t;return _=k.DataView,t=v.taskRunner(1),g.shrinkFile=function(i,s){var a,e=this;return a=m.Deferred(),r&&_&&y?(t(function(e){var o;return a.always(e),(o=v.imageLoader(r.createObjectURL(i))).always(function(e){return r.revokeObjectURL(e.src)}),o.fail(function(){return a.reject("not image")}),o.done(function(t){var n;return a.notify(.1),n=g.getExif(i).always(function(i){var e,r;return a.notify(.2),r="resolved"===n.state(),(o=g.shrinkImage(t,s)).progress(function(e){return a.notify(.2+.6*e)}),o.fail(a.reject),o.done(function(t){var e,n;return e="image/jpeg",n=s.quality||.8,!r&&g.hasTransparency(t)&&(e="image/png",n=void 0),v.canvasToBlob(t,e,n,function(e){return t.width=t.height=1,a.notify(.9),i?((o=g.replaceJpegChunk(e,225,[i.buffer])).done(a.resolve),o.fail(function(){return a.resolve(e)})):a.resolve(e)})}),null})})}),a.promise()):a.reject("support")},g.shrinkImage=function(n,e){var t,i,r,o,s,a,u,l,c,p,f,h,d;return i=m.Deferred(),h=.71,n.width*h*n.height*h<e.size?i.reject("not required"):(f=a=n.width,p=n.height,u=f/p,d=Math.floor(Math.sqrt(e.size*u)),r=Math.floor(e.size/Math.sqrt(e.size*u)),s=5e6,o=4096,l=function(){if(!(f<=d))return v.defer(function(){var e;return f=Math.round(f*h),p=Math.round(p*h),f*h<d&&(f=d,p=r),s<f*p&&(f=Math.floor(Math.sqrt(s*u)),p=Math.floor(s/Math.sqrt(s*u))),o<f&&(f=o,p=Math.round(f/u)),o<p&&(p=o,f=Math.round(u*p)),(e=U.createElement("canvas")).width=f,e.height=p,e.getContext("2d").drawImage(n,0,0,f,p),n.src="//:0",n.width=n.height=1,n=e,i.notify((a-f)/(a-d)),l()});i.resolve(n)},c=function(){var e,t;return(e=U.createElement("canvas")).width=d,e.height=r,(t=e.getContext("2d")).imageSmoothingQuality="high",t.drawImage(n,0,0,d,r),n.src="//:0",n.width=n.height=1,i.resolve(e)},"imageSmoothingQuality"in(t=U.createElement("canvas").getContext("2d"))?c():l(),i.promise())},g.drawFileToCanvas=function(e,f,h,d,t){var _,n;return _=m.Deferred(),r?((n=v.imageLoader(r.createObjectURL(e))).always(function(e){return r.revokeObjectURL(e.src)}),n.fail(function(){return _.reject("not image")}),n.done(function(p){return _.always(function(){return p.src="//:0"}),t&&p.width*p.height>t?_.reject("max source"):g.getExif(e).always(function(e){var t,n,i,r,o,s,a,u,l,c;return s=(a=4<(o=g.parseExifOrientation(e)||1))?[p.height,p.width]:[p.width,p.height],(u=[[1,0,0,1,0,0],[-1,0,0,1,r=(l=v.fitSize(s,[f,h]))[0],0],[-1,0,0,-1,r,i=l[1]],[1,0,0,-1,0,i],[0,1,1,0,0,0],[0,1,-1,0,r,0],[0,-1,-1,0,r,i],[0,-1,1,0,0,i]][o-1])?((t=U.createElement("canvas")).width=r,t.height=i,(n=t.getContext("2d")).transform.apply(n,u),a&&(r=(c=[i,r])[0],i=c[1]),d&&(n.fillStyle=d,n.fillRect(0,0,r,i)),n.drawImage(p,0,0,r,i),_.resolve(t,s)):_.reject("bad image")})}),_.promise()):_.reject("support")},g.readJpegChunks=function(r){var o,s,a,u,l;return l=function(e,t){var n;return(n=new i).onload=function(){return t(new _(n.result))},n.onerror=function(e){return o.reject("reader",e)},n.readAsArrayBuffer(e)},a=function(){return l(r.slice(s,s+128),function(e){var t,n,i;for(t=n=0,i=e.byteLength;0<=i?n<i:i<n;t=0<=i?++n:--n)if(255===e.getUint8(t)){s+=t;break}return u()})},u=function(){var i;return i=s,l(r.slice(s,s+=4),function(e){var t,n;return 4!==e.byteLength||255!==e.getUint8(0)?o.reject("corrupted"):218===(n=e.getUint8(1))?o.resolve():(t=e.getUint16(2)-2,l(r.slice(s,s+=t),function(e){return e.byteLength!==t?o.reject("corrupted"):(o.notify(i,t,n,e),a())}))})},o=m.Deferred(),i&&_?(s=2,l(r.slice(0,2),function(e){return 65496!==e.getUint16(0)?o.reject("not jpeg"):a()}),o.promise()):o.reject("support")},g.replaceJpegChunk=function(l,c,p){var f,h,d,e;return f=m.Deferred(),d=[],h=[],(e=g.readJpegChunks(l)).fail(f.reject),e.progress(function(e,t,n){if(n===c)return d.push(e),h.push(t)}),e.done(function(){var e,t,n,i,r,o,s,a,u;for(i=[l.slice(0,2)],o=0,a=p.length;o<a;o++)e=p[o],(n=new _(new ArrayBuffer(4))).setUint16(0,65280+c),n.setUint16(2,e.byteLength+2),i.push(n.buffer),i.push(e);for(r=2,t=s=0,u=d.length;0<=u?s<u:u<s;t=0<=u?++s:--s)d[t]>r&&i.push(l.slice(r,d[t])),r=d[t]+h[t]+4;return i.push(l.slice(r,l.size)),f.resolve(new y(i,{type:l.type}))}),f.promise()},g.getExif=function(e){var r,t;return r=null,(t=g.readJpegChunks(e)).progress(function(e,t,n,i){if(!r&&225===n&&14<=i.byteLength&&1165519206===i.getUint32(0)&&0===i.getUint16(4))return r=i}),t.then(function(){return r},function(e){return m.Deferred().reject(r,e)})},g.parseExifOrientation=function(e){var t,n,i,r,o;if(
!e||e.byteLength<14||1165519206!==e.getUint32(0)||0!==e.getUint16(4))return null;if(18761===e.getUint16(6))i=!0;else{if(19789!==e.getUint16(6))return null;i=!1}if(42!==e.getUint16(8,i))return null;for(r=8+e.getUint32(10,i),t=e.getUint16(r-2,i),n=o=0;0<=t?o<t:t<o;n=0<=t?++o:--o){if(e.byteLength<r+10)return null;if(274===e.getUint16(r,i))return e.getUint16(r+8,i);r+=12}return null},g.hasTransparency=function(e){var t,n,i,r,o,s,a;for(o=50,(t=U.createElement("canvas")).width=t.height=o,(n=t.getContext("2d")).drawImage(e,0,0,o,o),i=n.getImageData(0,0,o,o).data,t.width=t.height=1,r=s=3,a=i.length;s<a;r=s+=4)if(i[r]<254)return!0;return!1}})}.call(this),function(){var g,m,i=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,o=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};g=A.jQuery,m=A.utils,A.namespace("files",function(e){return e.ObjectFile=function(e){var t;function n(e){this.__file=e,this.setFile=i(this.setFile,this),n.__super__.constructor.apply(this,arguments),this.fileName=this.__file.name||"original",this.__notifyApi()}return o(n,e),t=null,n.prototype.sourceName="local",n.prototype.setFile=function(e){if(e&&(this.__file=e),this.sourceInfo.file=this.__file,this.__file)return this.fileSize=this.__file.size,this.fileType=this.__file.type||"application/octet-stream",this.settings.debugUploads&&m.debug("Use local file.",this.fileName,this.fileType,this.fileSize),this.__runValidators(),this.__notifyApi()},n.prototype.__startUpload=function(){var t,e,n,i=this;return this.apiDeferred.always(function(){return i.__file=null}),this.__file.size>=this.settings.multipartMinSize&&m.abilities.Blob?(this.setFile(),this.multipartUpload()):(e=m.abilities.iOSVersion,!this.settings.imageShrink||e&&e<8?(this.setFile(),this.directUpload()):(t=g.Deferred(),n=.4,m.image.shrinkFile(this.__file,this.settings.imageShrink).progress(function(e){return t.notify(e*n)}).done(this.setFile).fail(function(){return i.setFile(),n*=.1}).always(function(){return t.notify(n),i.directUpload().done(t.resolve).fail(t.reject).progress(function(e){return t.notify(n+e*(1-n))})}),t))},n.prototype.__autoAbort=function(e){return this.apiDeferred.fail(e.abort),e},n.prototype.directRunner=function(e){return t||(t=m.taskRunner(this.settings.parallelDirectUploads)),t(e)},n.prototype.directUpload=function(){var n,i=this;return n=g.Deferred(),this.__file?104857600<this.fileSize?this.__rejectApi("size"):this.directRunner(function(e){var t;if(n.always(e),"pending"===i.apiDeferred.state())return(t=new FormData).append("UPLOADCARE_PUB_KEY",i.settings.publicKey),t.append("signature",i.settings.secureSignature),t.append("expire",i.settings.secureExpire),t.append("UPLOADCARE_STORE",i.settings.doNotStore?"":"auto"),t.append("file",i.__file,i.fileName),t.append("file_name",i.fileName),t.append("source",i.sourceInfo.source),i.__autoAbort(g.ajax({xhr:function(){var e;return(e=g.ajaxSettings.xhr()).upload&&e.upload.addEventListener("progress",function(e){return n.notify(e.loaded/e.total)},!1),e},crossDomain:!0,type:"POST",url:i.settings.urlBase+"/base/?jsonerrors=1",headers:{"X-UC-User-Agent":i.settings._userAgent},contentType:!1,processData:!1,data:t,dataType:"json",error:n.reject,success:function(e){return(null!=e?e.file:void 0)?(i.fileId=e.file,n.resolve()):n.reject()}}))}):this.__rejectApi("baddata"),n},n.prototype.multipartUpload=function(){var t,n=this;return t=g.Deferred(),this.__file&&this.multipartStart().done(function(e){return n.uploadParts(e.parts,e.uuid).done(function(){return n.multipartComplete(e.uuid).done(function(e){return n.fileId=e.uuid,n.__handleFileData(e),t.resolve()}).fail(t.reject)}).progress(t.notify).fail(t.reject)}).fail(t.reject),t},n.prototype.multipartStart=function(){var t,n=this;return t={UPLOADCARE_PUB_KEY:this.settings.publicKey,signature:this.settings.secureSignature,expire:this.settings.secureExpire,filename:this.fileName,source:this.sourceInfo.source,size:this.fileSize,content_type:this.fileType,part_size:this.settings.multipartPartSize,UPLOADCARE_STORE:this.settings.doNotStore?"":"auto"},this.__autoAbort(m.jsonp(this.settings.urlBase+"/multipart/start/?jsonerrors=1","POST",t,{headers:{"X-UC-User-Agent":this.settings._userAgent}}).fail(function(e){if(n.settings.debugUploads)return m.log("Can't start multipart upload.",e,t)}))},n.prototype.uploadParts=function(o,s){var a,e,u,l,c,p,f,h,d,t,n,_=this;for(c=[],l=Date.now(),d=function(e,t){var n,i,r;if(c[e]=t,!(Date.now()-l<250)){for(l=Date.now(),i=n=0,r=c.length;i<r;i++)n+=t=c[i];return a.notify(n/_.fileSize)}},a=g.Deferred(),p=function(){var e,t,n,i,r;if(!(f>=_.fileSize))return n=f+_.settings.multipartPartSize,_.fileSize<n+_.settings.multipartMinLastPartSize&&(n=_.fileSize),t=_.__file.slice(f,n),f=n,i=h,u+=1,h+=1,e=0,(r=function(){if("pending"===_.apiDeferred.state())return c[i]=0,_.__autoAbort(g.ajax({xhr:function(){var e;return(e=g.ajaxSettings.xhr()).responseType="text",e.upload&&e.upload.addEventListener("progress",function(e){return d(i,e.loaded)},!1),e},url:o[i],crossDomain:!0,type:"PUT",processData:!1,contentType:_.fileType,data:t,error:function(){return(e+=1)>_.settings.multipartMaxAttempts?(_.settings.debugUploads&&m.log("Part #"+i+" and file upload is failed.",s),a.reject()):(_.settings.debugUploads&&m.debug("Part #"+i+"("+e+") upload is failed.",s),r())},success:function(){if(u-=1,p(),!u)return a.resolve()}}))})()},e=t=f=h=u=0,n=this.settings.multipartConcurrency;0<=n?t<n:n<t;e=0<=n?++t:--t)p();return a},n.prototype.multipartComplete=function(t){var e,n=this;return e={UPLOADCARE_PUB_KEY:this.settings.publicKey,uuid:t},this.__autoAbort(m.jsonp(this.settings.urlBase+"/multipart/complete/?jsonerrors=1","POST",e,{headers:{"X-UC-User-Agent":this.settings._userAgent}}).fail(function(e){if(n.settings.debugUploads)return m.log("Can't complete multipart upload.",t,n.settings.publicKey,e)}))},n}(e.BaseFile)})}.call(this),function(){var r,n,i=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,s=function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};r=A.jQuery,n=A.utils,A.namespace("files",function(e){return e.InputFile=function(e){function t(e){this.__input=e,this.__cleanUp=i(this.__cleanUp,this),t.__super__.constructor.apply(this,arguments),this.fileId=n.uuid(),this.fileName=r(this.__input).val().split("\\").pop(),this.__notifyApi()}return s(t,e),t.prototype.sourceName="local-compat",t.prototype.__startUpload=function(){var e,t,n,i;return e=r.Deferred(),i=this.settings.urlBase+"/iframe/",n="uploadcare--iframe-"+this.fileId,this.__iframe=r("<iframe>").attr({id:n,name:n}).css("display","none").appendTo("body").on("load",e.resolve).on("error",e.reject),t=function(e,t){return r("<input/>",{type:"hidden",name:e,value:t})},r(this.__input).attr("name","file"),this.__iframeForm=r("<form>").attr({method:"POST",action:i,enctype:"multipart/form-data",target:n}).append(t("UPLOADCARE_PUB_KEY",this.settings.publicKey)).append(t("UPLOADCARE_SIGNATURE",this.settings.secureSignature)).append(t("UPLOADCARE_EXPIRE",this.settings.secureExpire)).append(t("UPLOADCARE_FILE_ID",this.fileId)).append(t("UPLOADCARE_STORE",this.settings.doNotStore?"":"auto")).append(t("UPLOADCARE_SOURCE",this.sourceInfo.source)).append(this.__input).css("display","none").appendTo("body").submit(),e.always(this.__cleanUp)},t.prototype.__cleanUp=function(){var e,t;return null!=(e=this.__iframe)&&e.off("load error").remove(),null!=(t=this.__iframeForm)&&t.remove(),this.__iframe=null,this.__iframeForm=null},t}(e.BaseFile)})}.call(this),function(){var A,s,e;Function.prototype.scopedTo===undefined&&(Function.prototype.scopedTo=function(e,t){var n=this;return function(){return n.apply(e,Array.prototype.slice.call(t||[]).concat(Array.prototype.slice.call(arguments)))}}),(A=function(e,t){this.options=t||{},this.key=e,this.channels=new A.Channels,this.global_emitter=new A.EventsDispatcher;var i=this;this.checkAppKey(),this.connection=new A.Connection(this.key,this.options),
this.connection.bind("connected",function(){i.subscribeAll()}).bind("message",function(e){var t=0===e.event.indexOf("pusher_internal:"),n;e.channel&&(n=i.channel(e.channel))&&n.emit(e.event,e.data),t||i.global_emitter.emit(e.event,e.data)}).bind("disconnected",function(){i.channels.disconnect()}).bind("error",function(e){A.warn("Error",e)}),A.instances.push(this),A.isReady&&i.connect()}).instances=[],A.prototype={channel:function(e){return this.channels.find(e)},connect:function(){this.connection.connect()},disconnect:function(){this.connection.disconnect()},bind:function(e,t){return this.global_emitter.bind(e,t),this},bind_all:function(e){return this.global_emitter.bind_all(e),this},subscribeAll:function(){var e;for(channelName in this.channels.channels)this.channels.channels.hasOwnProperty(channelName)&&this.subscribe(channelName)},subscribe:function(n){var i=this,r=this.channels.add(n,this);return"connected"===this.connection.state&&r.authorize(this.connection.socket_id,this.options,function(e,t){e?r.emit("pusher:subscription_error",t):i.send_event("pusher:subscribe",{channel:n,auth:t.auth,channel_data:t.channel_data})}),r},unsubscribe:function(e){this.channels.remove(e),"connected"===this.connection.state&&this.send_event("pusher:unsubscribe",{channel:e})},send_event:function(e,t,n){return this.connection.send_event(e,t,n)},checkAppKey:function(){null!==this.key&&this.key!==undefined||A.warn("Warning","You must pass your app key when you instantiate Pusher.")}},A.Util={extend:function r(e,t){for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?e[n]=r(e[n]||{},t[n]):e[n]=t[n];return e},stringify:function n(){for(var e=["Pusher"],t=0;t<arguments.length;t++)"string"==typeof arguments[t]?e.push(arguments[t]):k.JSON==undefined?e.push(arguments[t].toString()):e.push(JSON.stringify(arguments[t]));return e.join(" : ")},arrayIndexOf:function(e,t){var n=Array.prototype.indexOf;if(null==e)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(i=0,l=e.length;i<l;i++)if(e[i]===t)return i;return-1}},A.debug=function(){A.log&&A.log(A.Util.stringify.apply(this,arguments))},A.warn=function(){if(k.console&&k.console.warn)k.console.warn(A.Util.stringify.apply(this,arguments));else{if(!A.log)return;A.log(A.Util.stringify.apply(this,arguments))}},A.VERSION="1.12.2",A.host="ws.pusherapp.com",A.ws_port=80,A.wss_port=443,A.channel_auth_endpoint="/pusher/auth",A.cdn_http="http://js.pusher.com/",A.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/",A.dependency_suffix=".min",A.channel_auth_transport="ajax",A.activity_timeout=12e4,A.pong_timeout=3e4,A.isReady=!1,A.ready=function(){A.isReady=!0;for(var e=0,t=A.instances.length;e<t;e++)A.instances[e].connect()},function(){function t(){this._callbacks={}}function e(e){this.callbacks=new t,this.global_callbacks=[],this.failThrough=e}t.prototype.get=function(e){return this._callbacks[this._prefix(e)]},t.prototype.add=function(e,t){var n=this._prefix(e);this._callbacks[n]=this._callbacks[n]||[],this._callbacks[n].push(t)},t.prototype.remove=function(e,t){if(this.get(e)){var n=A.Util.arrayIndexOf(this.get(e),t);this._callbacks[this._prefix(e)].splice(n,1)}},t.prototype._prefix=function(e){return"_"+e},e.prototype.bind=function(e,t){return this.callbacks.add(e,t),this},e.prototype.unbind=function(e,t){return this.callbacks.remove(e,t),this},e.prototype.emit=function(e,t){for(var n=0;n<this.global_callbacks.length;n++)this.global_callbacks[n](e,t);var i=this.callbacks.get(e);if(i)for(var n=0;n<i.length;n++)i[n](t);else this.failThrough&&this.failThrough(e,t);return this},e.prototype.bind_all=function(e){return this.global_callbacks.push(e),this},A.EventsDispatcher=e}(),function(){function r(e){return e.substr(0,1).toUpperCase()+e.substr(1)}function o(e,t,n){t[e]!==undefined&&t[e](n)}function e(e,t,n){A.EventsDispatcher.call(this),this.state=undefined,this.errors=[],this.stateActions=n,this.transitions=t,this.transition(e)}e.prototype.transition=function(e,t){var n=this.state,i=this.stateActions;if(n&&-1==A.Util.arrayIndexOf(this.transitions[n],e))throw this.emit("invalid_transition_attempt",{oldState:n,newState:e}),new Error("Invalid transition ["+n+" to "+e+"]");o(n+"Exit",i,t),o(n+"To"+r(e),i,t),o(e+"Pre",i,t),this.state=e,this.emit("state_change",{oldState:n,newState:e}),o(e+"Post",i,t)},e.prototype.is=function(e){return this.state===e},e.prototype.isNot=function(e){return this.state!==e},A.Util.extend(e.prototype,A.EventsDispatcher.prototype),A.Machine=e}(),(e=function(){var e=this;A.EventsDispatcher.call(this),k.addEventListener!==undefined&&(k.addEventListener("online",function(){e.emit("online",null)},!1),k.addEventListener("offline",function(){e.emit("offline",null)},!1))}).prototype.isOnLine=function(){return k.navigator.onLine===undefined||k.navigator.onLine},A.Util.extend(e.prototype,A.EventsDispatcher.prototype),A.NetInfo=e,function(){var m={initialized:["waiting","failed"],waiting:["connecting","permanentlyClosed"],connecting:["open","permanentlyClosing","impermanentlyClosing","waiting"],open:["connected","permanentlyClosing","impermanentlyClosing","waiting"],connected:["permanentlyClosing","waiting"],impermanentlyClosing:["waiting","permanentlyClosing"],permanentlyClosing:["permanentlyClosed"],permanentlyClosed:["waiting","failed"],failed:["permanentlyClosed"]},y=2e3,v=2e3,b=2e3,w=5*y,x=5*v,S=5*b;function C(e){e.connectionWait=0,"flash"===A.TransportType?e.openTimeout=5e3:e.openTimeout=2e3,e.connectedTimeout=2e3,e.connectionSecure=e.compulsorySecure,e.connectionAttempts=0}function e(e,t){var i=this;function n(){i.connectionWait<w&&(i.connectionWait+=y),i.openTimeout<x&&(i.openTimeout+=v),i.connectedTimeout<S&&(i.connectedTimeout+=b),!0!==i.compulsorySecure&&(i.connectionSecure=!i.connectionSecure),i.connectionAttempts++}function r(e,t){var n=A.ws_port,i="ws://";(t||"https:"===U.location.protocol)&&(n=A.wss_port,i="wss://");var r="flash"===A.TransportType?"true":"false";return i+A.host+":"+n+"/app/"+e+"?protocol=5&client=js&version="+A.VERSION+"&flash="+r}function o(){i._machine.transition("impermanentlyClosing")}function s(){i._activityTimer&&clearTimeout(i._activityTimer),i._activityTimer=setTimeout(function(){i.send_event("pusher:ping",{}),i._activityTimer=setTimeout(function(){i.socket.close()},i.options.pong_timeout||A.pong_timeout)},i.options.activity_timeout||A.activity_timeout)}function a(){i._activityTimer&&clearTimeout(i._activityTimer)}function u(){var e=i.connectionWait;if(0===e&&i.connectedAt){var t=1e3,n=(new Date).getTime()-i.connectedAt;n<t&&(e=t-n)}return e}function l(){i._machine.transition("open")}function c(e,t){i.emit("error",{type:"PusherError",data:{code:e,message:t}}),4e3===e?(i.compulsorySecure=!0,i.connectionSecure=!0,i.options.encrypted=!0,o()):e<4100?i._machine.transition("permanentlyClosing"):e<4200?(i.connectionWait=1e3,i._machine.transition("waiting")):e<4300?o():i._machine.transition("permanentlyClosing")}function p(e){var t=h(e);t!==undefined&&("pusher:connection_established"===t.event?i._machine.transition("connected",t.data.socket_id):"pusher:error"===t.event&&c(t.data.code,t.data.message))}function f(e){s();var t=h(e);if(t!==undefined){switch(A.debug("Event recd",t),t.event){case"pusher:error":i.emit("error",{type:"PusherError",data:t.data});break;case"pusher:ping":i.send_event("pusher:pong",{})}i.emit("message",t)}}function h(e){try{var t=JSON.parse(e.data);if("string"==typeof t.data)try{t.data=JSON.parse(t.data)}catch(n){if(!(n instanceof SyntaxError))throw n}return t}catch(n){i.emit("error",{type:"MessageParseError",error:n,data:e.data})}}function d(){i._machine.transition("waiting")}function _(e){i.emit("error",{type:"WebSocketError",error:e})}function g(e,t){var n=i.state;n!==(i.state=e)&&(A.debug("State changed",n+" -> "+e),i.emit("state_change",{previous:n,current:e}),i.emit(e,t))}A.EventsDispatcher.call(this),this.options=A.Util.extend({encrypted:!1},t),this.netInfo=new A.NetInfo,this.netInfo.bind("online",function(){i._machine.is("waiting")&&(i._machine.transition("connecting"),g("connecting"))}),this.netInfo.bind("offline",function(){i._machine.is("connected")&&(i.socket.onclose=undefined,i.socket.onmessage=undefined,i.socket.onerror=undefined,
i.socket.onopen=undefined,i.socket.close(),i.socket=undefined,i._machine.transition("waiting"))}),this._machine=new A.Machine("initialized",m,{initializedPre:function(){i.compulsorySecure=i.options.encrypted,i.key=e,i.socket=null,i.socket_id=null,i.state="initialized"},waitingPre:function(){0<i.connectionWait&&i.emit("connecting_in",i.connectionWait),i.netInfo.isOnLine()&&i.connectionAttempts<=4?g("connecting"):g("unavailable"),i.netInfo.isOnLine()&&(i._waitingTimer=setTimeout(function(){i._machine.transition("connecting")},u()))},waitingExit:function(){clearTimeout(i._waitingTimer)},connectingPre:function(){if(!1===i.netInfo.isOnLine())return i._machine.transition("waiting"),void g("unavailable");var e=r(i.key,i.connectionSecure);A.debug("Connecting",e),i.socket=new A.Transport(e),i.socket.onopen=l,i.socket.onclose=d,i.socket.onerror=_,i._connectingTimer=setTimeout(o,i.openTimeout)},connectingExit:function(){clearTimeout(i._connectingTimer),i.socket.onopen=undefined},connectingToWaiting:function(){n()},connectingToImpermanentlyClosing:function(){n()},openPre:function(){i.socket.onmessage=p,i.socket.onerror=_,i.socket.onclose=d,i._openTimer=setTimeout(o,i.connectedTimeout)},openExit:function(){clearTimeout(i._openTimer),i.socket.onmessage=undefined},openToWaiting:function(){n()},openToImpermanentlyClosing:function(){n()},connectedPre:function(e){i.socket_id=e,i.socket.onmessage=f,i.socket.onerror=_,i.socket.onclose=d,C(i),i.connectedAt=(new Date).getTime(),s()},connectedPost:function(){g("connected")},connectedExit:function(){a(),g("disconnected")},impermanentlyClosingPost:function(){i.socket&&(i.socket.onclose=d,i.socket.close())},permanentlyClosingPost:function(){i.socket?(i.socket.onclose=function(){C(i),i._machine.transition("permanentlyClosed")},i.socket.close()):(C(i),i._machine.transition("permanentlyClosed"))},failedPre:function(){g("failed"),A.debug("WebSockets are not available in this browser.")},permanentlyClosedPost:function(){g("disconnected")}})}e.prototype.connect=function(){this._machine.is("failed")||A.Transport?this._machine.is("initialized")?(C(this),this._machine.transition("waiting")):this._machine.is("waiting")&&!0===this.netInfo.isOnLine()?this._machine.transition("connecting"):this._machine.is("permanentlyClosed")&&(C(this),this._machine.transition("waiting")):this._machine.transition("failed")},e.prototype.send=function(e){if(this._machine.is("connected")){var t=this;return setTimeout(function(){t.socket.send(e)},0),!0}return!1},e.prototype.send_event=function(e,t,n){var i={event:e,data:t};return n&&(i.channel=n),A.debug("Event sent",i),this.send(JSON.stringify(i))},e.prototype.disconnect=function(){this._machine.is("permanentlyClosed")||(this._machine.is("waiting")||this._machine.is("failed")?this._machine.transition("permanentlyClosed"):this._machine.transition("permanentlyClosing"))},A.Util.extend(e.prototype,A.EventsDispatcher.prototype),A.Connection=e}(),function(){A.Channels=function(){this.channels={}},A.Channels.prototype={add:function(e,t){var n=this.find(e);if(n)return n;var i=A.Channel.factory(e,t);return this.channels[e]=i},find:function(e){return this.channels[e]},remove:function(e){delete this.channels[e]},disconnect:function(){for(var e in this.channels)this.channels[e].disconnect()}},A.Channel=function(n,e){var t=this;A.EventsDispatcher.call(this,function(e,t){A.debug("No callbacks on "+n+" for "+e)}),this.pusher=e,this.name=n,this.subscribed=!1,this.bind("pusher_internal:subscription_succeeded",function(e){t.onSubscriptionSucceeded(e)})},A.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1,this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(e){this.subscribed=!0,this.emit("pusher:subscription_succeeded")},authorize:function(e,t,n){return n(!1,{})},trigger:function(e,t){return this.pusher.send_event(e,t,this.name)}},A.Util.extend(A.Channel.prototype,A.EventsDispatcher.prototype),A.Channel.PrivateChannel={authorize:function(e,t,n){var i=this,r;return new A.Channel.Authorizer(this,A.channel_auth_transport,t).authorize(e,function(e,t){e||i.emit("pusher_internal:authorized",t),n(e,t)})}},A.Channel.PresenceChannel={init:function(){this.members=new e(this)},onSubscriptionSucceeded:function(e){this.subscribed=!0}};var e=function(n){var i=this,e=function(){this._members_map={},this.count=0,this.me=null};e.call(this),n.bind("pusher_internal:authorized",function(e){var t=JSON.parse(e.channel_data);n.bind("pusher_internal:subscription_succeeded",function(e){i._members_map=e.presence.hash,i.count=e.presence.count,i.me=i.get(t.user_id),n.emit("pusher:subscription_succeeded",i)})}),n.bind("pusher_internal:member_added",function(e){null===i.get(e.user_id)&&i.count++,i._members_map[e.user_id]=e.user_info,n.emit("pusher:member_added",i.get(e.user_id))}),n.bind("pusher_internal:member_removed",function(e){var t=i.get(e.user_id);t&&(delete i._members_map[e.user_id],i.count--,n.emit("pusher:member_removed",t))}),n.bind("pusher_internal:disconnected",function(){e.call(i)})};e.prototype={each:function(e){for(var t in this._members_map)e(this.get(t))},get:function(e){return this._members_map.hasOwnProperty(e)?{id:e,info:this._members_map[e]}:null}},A.Channel.factory=function(e,t){var n=new A.Channel(e,t);return 0===e.indexOf("private-")?A.Util.extend(n,A.Channel.PrivateChannel):0===e.indexOf("presence-")&&(A.Util.extend(n,A.Channel.PrivateChannel),A.Util.extend(n,A.Channel.PresenceChannel)),n.init(),n}}(),A.Channel.Authorizer=function(e,t,n){this.channel=e,this.type=t,this.authOptions=(n||{}).auth||{}},A.Channel.Authorizer.prototype={composeQuery:function(e){var t="&socket_id="+encodeURIComponent(e)+"&channel_name="+encodeURIComponent(this.channel.name);for(var n in this.authOptions.params)t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(this.authOptions.params[n]);return t},authorize:function(e,t){return A.authorizers[this.type].call(this,e,t)}},A.auth_callbacks={},A.authorizers={ajax:function(e,i){var t=this,r;for(var n in(r=A.XHR?new A.XHR:k.XMLHttpRequest?new k.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("POST",A.channel_auth_endpoint,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.authOptions.headers)r.setRequestHeader(n,this.authOptions.headers[n]);return r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){var e,t=!1;try{e=JSON.parse(r.responseText),t=!0}catch(n){i(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+r.responseText)}t&&i(!1,e)}else A.warn("Couldn't get auth info from your webapp",r.status),i(!0,r.status)},r.send(this.composeQuery(e)),r},jsonp:function(e,t){this.authOptions.headers!==undefined&&A.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var n=U.createElement("script");A.auth_callbacks[this.channel.name]=function(e){t(!1,e)};var i="Pusher.auth_callbacks['"+this.channel.name+"']";n.src=A.channel_auth_endpoint+"?callback="+encodeURIComponent(i)+this.composeQuery(e);var r=U.getElementsByTagName("head")[0]||U.documentElement;r.insertBefore(n,r.firstChild)}};var s=function(){function r(e,t){U.addEventListener?e.addEventListener("load",t,!1):e.attachEvent("onreadystatechange",function(){"loaded"!=e.readyState&&"complete"!=e.readyState||t()})}function o(e,t){var n=U.getElementsByTagName("head")[0],i=U.createElement("script");i.setAttribute("src",e),i.setAttribute("type","text/javascript"),i.setAttribute("async",!0),r(i,function(){t()}),n.appendChild(i)}return function(e,t){for(var n=0,i=0;i<e.length;i++)o(e[i],function(){e.length==++n&&setTimeout(t,0)})}}();!function(){!k.WebSocket&&k.MozWebSocket&&(k.WebSocket=k.MozWebSocket),k.WebSocket&&(A.Transport=k.WebSocket,A.TransportType="native");var e,t=("http:"==U.location.protocol?A.cdn_http:A.cdn_https)+A.VERSION,n=[];k.JSON||n.push(t+"/json2"+A.dependency_suffix+".js"),k.WebSocket||(k.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,n.push(t+"/flashfallback"+A.dependency_suffix+".js"));var i=k.WebSocket?function(){A.ready()}:function(){k.WebSocket?(A.Transport=k.WebSocket,A.TransportType="flash",
k.WEB_SOCKET_SWF_LOCATION="https://s3.amazonaws.com/uploadcare-static/WebSocketMainInsecure.swf",WebSocket.__addTask(function(){A.ready()}),WebSocket.__initialize()):(A.Transport=null,A.TransportType="none",A.ready())},r=function(e){var t=function(){U.body?e():setTimeout(t,0)};t()},o=function(){r(i)};0<n.length?s(n,o):o()}(),this.Pusher=A}.call(A),function(){var r,o={}.hasOwnProperty,s=function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};r=A.jQuery,A.namespace("utils.pusher",function(e){var t,n,i;return n={},A.Pusher.prototype.constructor=A.Pusher,t=function(e){function n(){return i=n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.subscribe=function(e){return this.disconnectTimeout&&(clearTimeout(this.disconnectTimeout),this.disconnectTimeout=null),this.connect(),n.__super__.subscribe.apply(this,arguments)},n.prototype.unsubscribe=function(e){var t=this;if(n.__super__.unsubscribe.apply(this,arguments),r.isEmptyObject(this.channels.channels))return this.disconnectTimeout=setTimeout(function(){return t.disconnectTimeout=null,t.disconnect()},5e3)},n}(A.Pusher),e.getPusher=function(e){return null==n[e]&&(n[e]=new t(e)),n[e].connect(),n[e]}})}.call(this),function(){var u,n,l,o=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,t=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};u=A.jQuery,l=A.utils,n=A.utils.pusher,A.namespace("files",function(e){var s,a;return e.UrlFile=function(e){function r(e){var t,n;if(this.__url=e,this.__listenWatcher=o(this.__listenWatcher,this),r.__super__.constructor.apply(this,arguments),n=l.splitUrlRegex.exec(this.__url)[3].split("/").pop())try{this.fileName=decodeURIComponent(n)}catch(i){t=i,this.fileName=n}this.__notifyApi()}return t(r,e),r.prototype.sourceName="url",r.prototype.allEvents="progress success error fail",r.prototype.setName=function(e){return this.fileName=e,this.__realFileName=e,this.__notifyApi()},r.prototype.setIsImage=function(e){return this.isImage=e,this.__notifyApi()},r.prototype.__startUpload=function(){var t,n,i,r,o=this;return n=u.Deferred(),r=new a(this.settings),i=new s(this.settings),t={pub_key:this.settings.publicKey,signature:this.settings.secureSignature,expire:this.settings.secureExpire,source_url:this.__url,filename:this.__realFileName||"",source:this.sourceInfo.source,store:this.settings.doNotStore?"":"auto",jsonerrors:1},l.defer(function(){if("pending"===o.apiDeferred.state())return l.jsonp(o.settings.urlBase+"/from_url/","GET",t,{headers:{"X-UC-User-Agent":o.settings._userAgent}}).fail(function(e){return o.settings.debugUploads&&l.debug("Can't start upload from URL.",e,t),n.reject()}).done(function(e){var t;if("pending"===o.apiDeferred.state())return o.settings.debugUploads&&(l.debug("Start watchers.",e.token),t=setInterval(function(){return l.debug("Still watching.",e.token)},5e3),n.done(function(){return l.debug("Stop watchers.",e.token)}).always(function(){return clearInterval(t)})),o.__listenWatcher(n,u([r,i])),n.always(function(){return u([r,i]).off(o.allEvents),r.stopWatching(),i.stopWatching()}),u(r).one(o.allEvents,function(){if(i.interval)return o.settings.debugUploads&&l.debug("Start using pusher.",e.token),i.stopWatching()}),r.watch(e.token),i.watch(e.token)})}),n},r.prototype.__listenWatcher=function(n,e){var i=this;return e.on("progress",function(e,t){return i.fileSize=t.total,n.notify(t.done/t.total)}).on("success",function(e,t){return u(e.target).trigger("progress",t),i.fileId=t.uuid,i.__handleFileData(t),n.resolve()}).on("error fail",n.reject)},r}(e.BaseFile),a=function(){function e(e){this.settings=e;try{this.pusher=n.getPusher(this.settings.pusherKey)}catch(t){this.pusher=null}}return e.prototype.watch=function(e){var t,n=this;if(this.token=e,this.pusher)return(t=this.pusher.subscribe("task-status-"+this.token)).bind_all(function(e,t){return u(n).trigger(e,t)})},e.prototype.stopWatching=function(){if(this.pusher)return this.pusher.unsubscribe("task-status-"+this.token)},e}(),s=function(){function e(e){this.settings=e,this.poolUrl=this.settings.urlBase+"/from_url/status/"}return e.prototype.watch=function(e){var t,n=this;return this.token=e,(t=function(){return n.interval=setTimeout(function(){return n.__updateStatus().done(function(){if(n.interval)return t()})},333)})()},e.prototype.stopWatching=function(){return this.interval&&clearTimeout(this.interval),this.interval=null},e.prototype.__updateStatus=function(){var t=this;return l.jsonp(this.poolUrl,"GET",{token:this.token},{headers:{"X-UC-User-Agent":this.settings._userAgent}}).fail(function(e){return u(t).trigger("error")}).done(function(e){return u(t).trigger(e.status,e)})},e}()})}.call(this),function(){var e,i,r={}.hasOwnProperty,o=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=A.jQuery,i=A.utils,A.namespace("files",function(e){return e.UploadedFile=function(e){function n(e){var t;n.__super__.constructor.apply(this,arguments),(t=i.splitCdnUrl(e))?(this.fileId=t[1],t[2]&&(this.cdnUrlModifiers=t[2])):this.__rejectApi("baddata")}return o(n,e),n.prototype.sourceName="uploaded",n}(e.BaseFile),e.ReadyFile=function(e){function t(e){t.__super__.constructor.apply(this,arguments),e?(this.fileId=e.uuid,this.__handleFileData(e)):this.__rejectApi("deleted")}return o(t,e),t.prototype.sourceName="uploaded",t}(e.BaseFile)})}.call(this),function(){var s,e,o,t,c,p,n,a=[].slice,r={}.hasOwnProperty,u=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=A.namespace,s=A.jQuery,p=A.utils,n=A.locale,t=n.t,o=A.settings,c=A.files,e("files",function(e){return e.FileGroup=function(){function e(e,t){var n=this,r;this.__uuid=null,this.settings=o.build(t),this.__fileColl=new p.CollectionOfPromises(e),this.__allFilesDf=s.when.apply(s,this.files()),this.__fileInfosDf=(e=function(){var e,t,n,i;for(i=[],e=0,t=(n=this.files()).length;e<t;e++)r=n[e],i.push(r.then(null,function(e,t){return s.when(t)}));return i}.call(n),s.when.apply(s,e)),this.__createGroupDf=s.Deferred(),this.__initApiDeferred()}return e.prototype.files=function(){return this.__fileColl.get()},e.prototype.__save=function(){var t=this;if(!this.__saved)return this.__saved=!0,this.__allFilesDf.done(function(){return t.__createGroup().done(function(e){return t.__uuid=e.id,t.__buildInfo(function(e){return t.settings.imagesOnly&&!e.isImage?t.__createGroupDf.reject("image",e):t.__createGroupDf.resolve(e)})}).fail(function(){return t.__createGroupDf.reject("createGroup")})})},e.prototype.promise=function(){return this.__save(),this.__apiDf.promise()},e.prototype.__initApiDeferred=function(){var t,e,n,i=this;return this.__apiDf=s.Deferred(),this.__progressState="uploading",e=function(t){return i.__buildInfo(function(e){return i.__apiDf.reject(t,e)})},n=function(e){return i.__apiDf.resolve(e)},(t=function(){return i.__apiDf.notify(i.__progressInfo())})(),this.__fileColl.onAnyProgress(t),this.__allFilesDf.done(function(){return i.__progressState="uploaded",t()}).fail(e),this.__createGroupDf.done(function(e){return i.__progressState="ready",t(),n(e)}).fail(e)},e.prototype.__progressInfo=function(){var e,t,n,i,r;for(i=e=0,r=(n=this.__fileColl.lastProgresses()).length;i<r;i++)e+=((null!=(t=n[i])?t.progress:void 0)||0)/n.length;return{state:this.__progressState,uploadProgress:e,progress:"ready"===this.__progressState?1:.9*e}},e.prototype.__buildInfo=function(r){var o;return o={uuid:this.__uuid,cdnUrl:this.__uuid?this.settings.cdnBase+"/"+this.__uuid+"/":null,name:t("file",this.__fileColl.length()),count:this.__fileColl.length(),size:0,isImage:!0,isStored:!0},this.__fileInfosDf.done(function(){var e,t,n,i;for(t=0,i=(e=1<=arguments.length?a.call(arguments,0):[]).length;t<i;t++)n=e[t],o.size+=n.size,n.isImage||(o.isImage=!1),n.isStored||(o.isStored=!1);return r(o)})},
e.prototype.__createGroup=function(){var t,n=this;return t=s.Deferred(),this.__fileColl.length()?this.__fileInfosDf.done(function(){var i,r;return r=1<=arguments.length?a.call(arguments,0):[],p.jsonp(n.settings.urlBase+"/group/","POST",{pub_key:n.settings.publicKey,signature:n.settings.secureSignature,expire:n.settings.secureExpire,files:function(){var e,t,n;for(n=[],e=0,t=r.length;e<t;e++)i=r[e],n.push("/"+i.uuid+"/"+(i.cdnUrlModifiers||""));return n}()},{headers:{"X-UC-User-Agent":n.settings._userAgent}}).fail(function(e){return n.settings.debugUploads&&p.log("Can't create group.",n.settings.publicKey,e),t.reject()}).done(t.resolve)}):t.reject(),t.promise()},e.prototype.api=function(){return this.__api||(this.__api=p.bindAll(this,["promise","files"])),this.__api},e}(),e.SavedFileGroup=function(e){function i(e,t){var n;this.__data=e,n=A.filesFrom("ready",this.__data.files,t),i.__super__.constructor.call(this,n,t)}return u(i,e),i.prototype.__createGroup=function(){return p.wrapToPromise(this.__data)},i}(e.FileGroup)}),e("",function(e){return e.FileGroup=function(e,t){var n,i,r,o,s,a,u,l;for(null==e&&(e=[]),i=[],o=0,a=e.length;o<a;o++)if(r=e[o],p.isFile(r))i.push(r);else if(p.isFileGroup(r))for(s=0,u=(l=r.files()).length;s<u;s++)n=l[s],i.push(n);return new c.FileGroup(i,t).api()},e.loadFileGroup=function(e,n){var i,t,r=this;return n=o.build(n),i=s.Deferred(),(t=p.groupIdRegex.exec(e))?p.jsonp(n.urlBase+"/group/info/","GET",{jsonerrors:1,pub_key:n.publicKey,group_id:t[0]},{headers:{"X-UC-User-Agent":n._userAgent}}).fail(function(e){return n.debugUploads&&p.log("Can't load group info. Probably removed.",t[0],n.publicKey,e),i.reject()}).done(function(e){var t;return t=new c.SavedFileGroup(e,n),i.resolve(t.api())}):i.reject(),i.promise()}}),e("utils",function(u){return u.isFileGroup=function(e){return e&&e.files&&e.promise},u.valueToGroup=function(i,r){var e,o;if(i)if(s.isArray(i))e=function(){var e,t,n;for(n=[],e=0,t=i.length;e<t;e++)o=i[e],n.push(u.valueToFile(o,r));return n}(),i=A.FileGroup(e,r);else if(!u.isFileGroup(i))return A.loadFileGroup(i,r);return u.wrapToPromise(i||null)},u.isFileGroupsEqual=function(e,t){var n,i,r,o,s,a;if(e===t)return!0;if(!u.isFileGroup(e)||!u.isFileGroup(t))return!1;if(i=e.files(),r=t.files(),i.length!==r.length)return!1;for(o=s=0,a=i.length;s<a;o=++s)if((n=i[o])!==r[o])return!1;return!0}})}.call(this),function(){var l,e,c,t;t=A.utils,l=A.jQuery,e=A.files,c=A.settings,A.namespace("",function(i){var u;return i.fileFrom=function(e,t,n){return i.filesFrom(e,[t],n)[0]},i.filesFrom=function(e,t,n){var i,r,o,s,a;for(n=c.build(n||{}),a=[],o=0,s=t.length;o<s;o++)r=t[o],i=null,l.isArray(r)&&(i=r[1],r=r[0]),a.push(new u[e](r,n,i).promise());return a},u={object:e.ObjectFile,input:e.InputFile,url:e.UrlFile,uploaded:e.UploadedFile,ready:e.ReadyFile}})}.call(this),function(){var e,t;(e=A.expose)("globals",A.settings.common),e("start",A.settings.common),e("fileFrom"),e("filesFrom"),e("FileGroup"),e("loadFileGroup"),e("locales",function(){var e;for(t in e=[],A.locale.translations)e.push(t);return e}())}.call(this),A.__exports});